(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2291],{94072:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/memory-curve",function(){return n(62425)}])},50043:function(e,t,n){"use strict";n.d(t,{Db:function(){return i},Lp:function(){return a},wz:function(){return c}});var o=n(95740),r=n(53539);let a=r.Client.create(o.DW,String(o.pF)),l=async()=>{let e=await a.sp.getStorageProviders(),t=(null!=e?e:[]).filter(e=>e.endpoint.includes("nodereal"));return t},i=async()=>{let e=await l();return e.map(e=>{var t;return{address:e.operatorAddress,endpoint:e.endpoint,name:null===(t=e.description)||void 0===t?void 0:t.moniker}})},c=async()=>{var e;let t=await l(),n=Math.floor(Math.random()*t.length),o=[...t.slice(0,n),...t.slice(n+1)].map(e=>e.operatorAddress),r={id:t[n].id,endpoint:t[n].endpoint,primarySpAddress:null===(e=t[n])||void 0===e?void 0:e.operatorAddress,sealAddress:t[n].sealAddress,secondarySpAddresses:o};return r}},21418:function(e,t,n){"use strict";n.d(t,{J:function(){return i}});var o=n(67294),r=n(50043),a=n(95740);function l(e){return e?"fileList_".concat(e):""}function i(e,t,n,i,c,s){let[d,u]=(0,o.useState)([]),[f,m]=(0,o.useState)(!1),[v,h]=(0,o.useState)(null);return(0,o.useEffect)(()=>{if(!e||!t)return;let o=!1;return async function(){var s,d;m(!0),h(null);let f=function(e){if(!e)return null;let t=localStorage.getItem(l(e));if(!t)return null;try{let{data:n,timestamp:o}=JSON.parse(t);if(Date.now()-o<a.U$)return n;return localStorage.removeItem(l(e)),null}catch(t){return localStorage.removeItem(l(e)),null}}(e);if(f){u(f),m(!1);return}try{let o=await (0,r.wz)(),a=o.endpoint;if(!a){c&&i&&c({open:!0,message:i.createNoteFail}),h("endpoint missing"),u([]),m(!1);return}let f=await n.object.listObjects({bucketName:t,endpoint:a}),v=(null===(d=f.body)||void 0===d?void 0:null===(s=d.GfSpListObjectsByBucketNameResponse)||void 0===s?void 0:s.Objects)||[];u(v),"string"==typeof e&&localStorage.setItem(l(e),JSON.stringify({data:v,timestamp:Date.now()}))}catch(e){u([]),h((null==e?void 0:e.message)||"fetch error")}finally{o||m(!1)}}(),()=>{o=!0}},[e,t,n,i,c,s]),[d,f,v]}},62425:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var o=n(85893),r=n(67294),a=n(5152),l=n.n(a),i=n(80366),c=n(56387),s=n(38793),d=n(77221),u=n(21418),f=n(50043);n(95740);let m=l()(()=>n.e(9482).then(n.bind(n,9482)),{loadableGenerated:{webpack:()=>[9482]},ssr:!1}),v={zh:{title:"记忆曲线分析",global:"全部笔记",yLabel:"记忆保持率(%)",date:"日期",time:"时间",retention:"记忆保持率",noData:"暂无复习数据",selectNote:"请选择笔记曲线",searchPlaceholder:"搜索...",userCurve:"您的记忆曲线",warningCurve:"未复习曲线",ebbinghausCurve:"艾宾浩斯曲线",reviewPoint:"记忆点"},en:{title:"Memory Curve Analysis",global:"All Notes",yLabel:"Retention (%)",date:"Date",time:"Time",retention:"Retention",noData:"No review data",selectNote:"Please select a note curve",searchPlaceholder:"Search...",userCurve:"Your Memory Curve",warningCurve:"No Review Curve",ebbinghausCurve:"Ebbinghaus Curve",reviewPoint:"Review Point"}};function h(e,t){let n=[{t:0,r:1}];for(let o of t){let t=(o.timestamp-e)/86400;if(t>=0){let e=Math.min(1,Math.max(0,o.score/10));n.push({t:t,r:e})}}return n}function b(e){let t=0,n=0;for(let o of e)o.r<=0||(t+=o.t*Math.log(o.r),n+=o.t*o.t);let o=-t/(n||1);return Math.max(.01,Math.min(1,o))}function p(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:45,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2,l=[],i=[];for(let e=0;e<=o;e+=r)l.push(e),i.push((1-a)*Math.exp(-n*e)+a);let c=h(e,t);return{x:l,y:i,reviewPoints:c}}function g(){let{lang:e,setLang:t}=(0,c.ZK)(),n=v[e],{address:a}=(0,s.mA)(),l=a?"".concat(String(a).toLowerCase(),"-memorycloud"):"",[g]=(0,u.J)(a,l,f.Lp),[y,x]=(0,r.useState)({}),[w,S]=(0,r.useState)([]),[j,C]=(0,r.useState)("global"),[N,O]=(0,r.useState)("");[...w.filter(e=>e.toLowerCase().includes(N.toLowerCase()))],(0,r.useEffect)(()=>{if(!a)return;let e=g.map(e=>{var t;return null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName}).filter(e=>!!e&&/^(.*)\/$/.test(e)&&e.indexOf("/")===e.length-1&&-1===e.slice(0,-1).indexOf("/")),t={};e.forEach(e=>{let n=g.filter(t=>{var n;let o=null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName;return"string"==typeof o&&o.startsWith(e+"review/")&&/^\d+_\d+$/.test(o.slice((e+"review/").length))});t[e.slice(0,-1)]=n.map(t=>{var n,o;let r=null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName;return{noteId:e.slice(0,-1),time:(null===(o=t.ObjectInfo)||void 0===o?void 0:o.CreateAt)||0,score:function(e,t){let n=t+"review/";if(!e.startsWith(n))return 0;let o=e.slice(n.length),r=o.split("_");if(2===r.length){let e=parseInt(r[1],10);return isNaN(e)?0:e}return 0}(r,e)}}).filter(e=>e.time&&e.score)}),x(t),S(Object.keys(t))},[a,g]),(0,r.useEffect)(()=>{Object.entries(y).map(e=>{var t,n;let[o,r]=e;if(!r.length){let e=g.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===o+"/"}),t=(null==e?void 0:null===(n=e.ObjectInfo)||void 0===n?void 0:n.CreateAt)||0,r=[],a=h(t,r);return{noteId:o,curve:p(t,r,.25,45,3,.05),stdCurve:p(t,[],.2,45,3,.3),reviewPoints:a,hasReview:!1}}let a=g.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===o+"/"}),l=(null==a?void 0:null===(t=a.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0,i=r.map(e=>({timestamp:e.time,score:e.score})),c=h(l,i),s=b(c);return{noteId:o,curve:p(l,i,s,45,3,.2),stdCurve:p(l,[],.2,45,3,.3),reviewPoints:c,hasReview:!0}})},[y,g]),Date.now();let I=w.map(e=>{var t;let n=g.find(t=>{var n;return(null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName)===e+"/"}),o=(null==n?void 0:null===(t=n.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0,r=(y[e]||[]).map(e=>({timestamp:e.time,score:e.score})),a=r.length>0,l=h(o,r),i=a?b(l):.25,c=a?p(o,r,i,45,3,.2):p(o,r,.25,45,3,.05),s=p(o,[],.2,45,3,.3);return{noteId:e,curve:c,stdCurve:s,reviewPoints:l,hasReview:a}}),A=.25,L=[],k=0,M=[];w.forEach(e=>{var t;let n=g.find(t=>{var n;return(null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName)===e+"/"}),o=(null==n?void 0:null===(t=n.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0;(!k||o<k)&&(k=o);let r=(y[e]||[]).map(e=>({timestamp:e.time,score:e.score}));if(r.length>0){let t=h(o,r);M.push(b(t)),t.forEach(t=>L.push({t:t.t,r:t.r,noteId:e}))}}),M.length>0&&(A=M.reduce((e,t)=>e+t,0)/M.length);let D=p(k,[],A,45,3,.2),P=p(k,[],.2,45,3,.3),R=[{value:"global",label:n.global},...w.map(e=>({value:e,label:e}))];return(0,o.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col text-white",children:[(0,o.jsx)(i.Z,{lang:e,setLang:t}),(0,o.jsxs)("div",{className:"max-w-5xl w-full mx-auto mt-2 mb-12 rounded-3xl shadow-2xl border border-cyan-500/30 bg-slate-900/80 pt-6 pb-10 px-10 flex flex-col items-center",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold mb-2 text-cyan-300 drop-shadow-lg tracking-wide",children:n.title}),(0,o.jsx)("div",{className:"flex justify-center w-full mb-8",children:(0,o.jsx)("div",{className:"w-full max-w-md",children:(0,o.jsx)(d.ZP,{options:R,value:R.find(e=>e.value===j),onChange:e=>C((null==e?void 0:e.value)||"global"),placeholder:n.searchPlaceholder,isSearchable:!0,styles:{container:e=>({...e,minWidth:320,width:"100%",background:"rgba(30,41,59,0.7)",borderRadius:12,boxShadow:"0 0 0 1.5px #22d3ee55",color:"#e0e7ef"}),control:e=>({...e,background:"rgba(30,41,59,0.7)",border:"1.5px solid #22d3ee55",borderRadius:12,color:"#e0e7ef",minHeight:48}),menu:e=>({...e,background:"rgba(30,41,59,0.98)",borderRadius:12,color:"#e0e7ef",zIndex:9999}),option:(e,t)=>({...e,background:t.isSelected?"linear-gradient(90deg,#06b6d4,#6366f1)":t.isFocused?"rgba(14,165,233,0.15)":"transparent",color:t.isSelected?"#fff":"#e0e7ef",borderRadius:8,fontWeight:t.isSelected?700:500}),singleValue:e=>({...e,color:"#e0e7ef"}),input:e=>({...e,color:"#e0e7ef"}),placeholder:e=>({...e,color:"#7dd3fc"})},theme:e=>({...e,borderRadius:12,colors:{...e.colors,primary25:"#0ea5e9",primary:"#06b6d4",neutral0:"rgba(30,41,59,0.7)",neutral80:"#e0e7ef"}})})})}),(0,o.jsx)("div",{className:"w-full max-w-4xl mx-auto",style:{height:480},children:0===w.length?(0,o.jsx)("div",{className:"text-slate-400 text-center pt-32 text-lg tracking-wide",children:n.noData}):(0,o.jsx)("div",{className:"bg-slate-800/80 rounded-2xl shadow-inner border border-cyan-500/20 p-4",style:{height:440,minWidth:600},children:(0,o.jsx)(m,{option:(()=>{let e=[];if("global"===j)e=[{name:n.userCurve,type:"line",data:D.x.map((e,t)=>[1e3*k+864e5*e,Math.round(100*D.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:3,color:"#6366F1"},itemStyle:{color:"#6366F1"}},{name:n.ebbinghausCurve,type:"line",data:P.x.map((e,t)=>[1e3*k+864e5*e,Math.round(100*P.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:2,type:"solid",color:"#22c55e"},itemStyle:{color:"#22c55e"},emphasis:{disabled:!0}},{name:n.reviewPoint,type:"scatter",data:L.map(e=>[1e3*k+864e5*e.t,Math.round(100*e.r),e.noteId]),symbolSize:10,itemStyle:{color:"#f90"},tooltip:{show:!0,trigger:"item",formatter:e=>{let t="";return e.data&&e.data[2]?t=e.data[2]:e.value&&e.value[2]?t=e.value[2]:e.name&&(t=e.name),"".concat(n.reviewPoint,"<br/>").concat("All Notes"!==n.global?"笔记: ".concat(t,"<br/>"):"").concat(n.date,": ").concat(new Date(e.data[0]).toLocaleDateString(),"<br/>").concat(n.retention,": ").concat(e.data[1],"%")}}}];else if("global"!==j){let o=I.find(e=>e.noteId===j);if(o){var t;let r=g.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===j+"/"}),a=(null==r?void 0:null===(t=r.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0;e=[{name:o.hasReview?n.userCurve:n.warningCurve,type:"line",data:o.curve.x.map((e,t)=>[1e3*a+864e5*e,Math.round(100*o.curve.y[t])]),smooth:.5,symbol:"none",lineStyle:o.hasReview?{width:3,color:"#6366F1"}:{width:3,color:"#ef4444",type:"solid"},itemStyle:o.hasReview?{color:"#6366F1"}:{color:"#ef4444"}},{name:n.ebbinghausCurve,type:"line",data:o.stdCurve.x.map((e,t)=>[1e3*a+864e5*e,Math.round(100*o.stdCurve.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:2,type:"solid",color:"#22c55e"},itemStyle:{color:"#22c55e"},emphasis:{disabled:!0}},{name:n.reviewPoint,type:"scatter",data:o.curve.reviewPoints.map(e=>[1e3*a+864e5*e.t,Math.round(100*e.r)]),symbolSize:10,itemStyle:{color:"#f90"},tooltip:{show:!0,formatter:e=>"".concat(n.reviewPoint,"<br/>").concat(n.date,": ").concat(new Date(e.data[0]).toLocaleDateString(),"<br/>").concat(n.retention,": ").concat(e.data[1],"%")}}]}}return e.length&&e[0].data&&0!==e[0].data.length?{tooltip:{trigger:"axis",formatter:e=>Array.isArray(e)?e.map(e=>"".concat(e.seriesName,": ").concat(e.data[1],"%<br/>").concat(new Date(e.data[0]).toLocaleDateString())).join("<br/>"):"",backgroundColor:"rgba(30,41,59,0.98)",borderColor:"#22d3ee",textStyle:{color:"#fff",fontWeight:500}},legend:{data:e.map(e=>e.name),textStyle:{color:"#fff",fontWeight:600,fontSize:15}},xAxis:{type:"time",name:n.date,axisLabel:{color:"#fff",fontWeight:500,fontSize:14,formatter:e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"-").concat(t.getDate())}},nameTextStyle:{color:"#fff",fontWeight:600,fontSize:15},axisLine:{lineStyle:{color:"#fff"}},axisTick:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",name:n.yLabel,min:0,max:100,axisLabel:{color:"#fff",fontWeight:500,fontSize:14},nameTextStyle:{color:"#fff",fontWeight:600,fontSize:15},axisLine:{lineStyle:{color:"#fff"}},axisTick:{lineStyle:{color:"#fff"}},splitLine:{lineStyle:{color:"#334155"}}},dataZoom:[{type:"slider",xAxisIndex:0},{type:"inside",xAxisIndex:0}],series:e}:{xAxis:{type:"time",name:n.date},yAxis:{type:"value",min:0,max:100,name:n.yLabel},series:[]}})(),notMerge:!0,lazyUpdate:!0,style:{height:440,background:"transparent"}})})})]})]})}},993:function(){},46601:function(){},89214:function(){},85568:function(){},20131:function(){},16026:function(){},24654:function(){},88924:function(){},55024:function(){}},function(e){e.O(0,[3417,6792,3714,7878,1311,8742,6035,3631,9506,8764,7252,5640,5174,2993,366,9774,2888,179],function(){return e(e.s=94072)}),_N_E=e.O()}]);