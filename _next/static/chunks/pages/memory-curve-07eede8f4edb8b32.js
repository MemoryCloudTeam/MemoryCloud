(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2291],{94072:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/memory-curve",function(){return n(62425)}])},50043:function(e,t,n){"use strict";n.d(t,{Db:function(){return i},Lp:function(){return a},wz:function(){return c}});var r=n(95740),o=n(53539);let a=o.Client.create(r.DW,String(r.pF)),l=async()=>{let e=await a.sp.getStorageProviders(),t=(null!=e?e:[]).filter(e=>e.endpoint.includes("nodereal"));return t},i=async()=>{let e=await l();return e.map(e=>{var t;return{address:e.operatorAddress,endpoint:e.endpoint,name:null===(t=e.description)||void 0===t?void 0:t.moniker}})},c=async()=>{var e;let t=await l(),n=Math.floor(Math.random()*t.length),r=[...t.slice(0,n),...t.slice(n+1)].map(e=>e.operatorAddress),o={id:t[n].id,endpoint:t[n].endpoint,primarySpAddress:null===(e=t[n])||void 0===e?void 0:e.operatorAddress,sealAddress:t[n].sealAddress,secondarySpAddresses:r};return o}},21418:function(e,t,n){"use strict";n.d(t,{J:function(){return i}});var r=n(67294),o=n(50043),a=n(95740);function l(e){return e?"fileList_".concat(e):""}function i(e,t,n,i,c){let[s,d]=(0,r.useState)([]),[u,f]=(0,r.useState)(!1),[m,v]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e||!t)return;let r=!1;return async function(){var s,u;f(!0),v(null);let m=function(e){if(!e)return null;let t=localStorage.getItem(l(e));if(!t)return null;try{let{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<a.U$)return n;return localStorage.removeItem(l(e)),null}catch(t){return localStorage.removeItem(l(e)),null}}(e);if(m){d(m),f(!1);return}try{let r=await (0,o.wz)(),a=r.endpoint;if(!a){c&&i&&c({open:!0,message:i.createNoteFail}),v("endpoint missing"),d([]),f(!1);return}let m=await n.object.listObjects({bucketName:t,endpoint:a}),h=(null===(u=m.body)||void 0===u?void 0:null===(s=u.GfSpListObjectsByBucketNameResponse)||void 0===s?void 0:s.Objects)||[];d(h),"string"==typeof e&&localStorage.setItem(l(e),JSON.stringify({data:h,timestamp:Date.now()}))}catch(e){d([]),v((null==e?void 0:e.message)||"fetch error")}finally{r||f(!1)}}(),()=>{r=!0}},[e,t,n,i,c]),[s,u,m]}},62425:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(85893),o=n(67294),a=n(5152),l=n.n(a),i=n(80366),c=n(56387),s=n(38793),d=n(77221),u=n(21418),f=n(50043),m=n(95740);let v=e=>e?"fileList_".concat(e):"",h=e=>{if(!e)return null;let t=localStorage.getItem(v(e));if(!t)return null;try{let{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<m.U$)return n;return localStorage.removeItem(v(e)),null}catch(t){return localStorage.removeItem(v(e)),null}},b=l()(()=>n.e(9482).then(n.bind(n,9482)),{loadableGenerated:{webpack:()=>[9482]},ssr:!1}),g={zh:{title:"记忆曲线分析",global:"全部笔记",yLabel:"记忆保持率(%)",date:"日期",time:"时间",retention:"记忆保持率",noData:"暂无复习数据",selectNote:"请选择笔记曲线",searchPlaceholder:"搜索...",userCurve:"您的记忆曲线",warningCurve:"未复习曲线",ebbinghausCurve:"艾宾浩斯曲线",reviewPoint:"记忆点"},en:{title:"Memory Curve Analysis",global:"All Notes",yLabel:"Retention (%)",date:"Date",time:"Time",retention:"Retention",noData:"No review data",selectNote:"Please select a note curve",searchPlaceholder:"Search...",userCurve:"Your Memory Curve",warningCurve:"No Review Curve",ebbinghausCurve:"Ebbinghaus Curve",reviewPoint:"Review Point"}};function p(e,t){let n=[{t:0,r:1}];for(let r of t){let t=(r.timestamp-e)/86400;if(t>=0){let e=Math.min(1,Math.max(0,r.score/10));n.push({t:t,r:e})}}return n}function y(e){let t=0,n=0;for(let r of e)r.r<=0||(t+=r.t*Math.log(r.r),n+=r.t*r.t);let r=-t/(n||1);return Math.max(.01,Math.min(1,r))}function x(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:45,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2,l=[],i=[];for(let e=0;e<=r;e+=o)l.push(e),i.push((1-a)*Math.exp(-n*e)+a);let c=p(e,t);return{x:l,y:i,reviewPoints:c}}function w(){let{lang:e,setLang:t}=(0,c.ZK)(),n=g[e],{address:a}=(0,s.mA)(),l=a?"".concat(String(a).toLowerCase(),"-memorycloud"):"",[m]=(0,u.J)(a,l,f.Lp),[v,w]=(0,o.useState)({}),[S,j]=(0,o.useState)([]),[N,C]=(0,o.useState)("global"),[O,I]=(0,o.useState)("");[...S.filter(e=>e.toLowerCase().includes(O.toLowerCase()))],(0,o.useEffect)(()=>{if(!a)return;let e=h(a)||[],t=e.map(e=>{var t;return null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName}).filter(e=>!!e&&/^(.*)\/$/.test(e)&&e.indexOf("/")===e.length-1&&-1===e.slice(0,-1).indexOf("/")),n={};t.forEach(t=>{let r=e.filter(e=>{var n;let r=null===(n=e.ObjectInfo)||void 0===n?void 0:n.ObjectName;return"string"==typeof r&&r.startsWith(t+"review/")&&/^\d+_\d+$/.test(r.slice((t+"review/").length))});n[t.slice(0,-1)]=r.map(e=>{var n,r;let o=null===(n=e.ObjectInfo)||void 0===n?void 0:n.ObjectName;return{noteId:t.slice(0,-1),time:(null===(r=e.ObjectInfo)||void 0===r?void 0:r.CreateAt)||0,score:function(e,t){let n=t+"review/";if(!e.startsWith(n))return 0;let r=e.slice(n.length),o=r.split("_");if(2===o.length){let e=parseInt(o[1],10);return isNaN(e)?0:e}return 0}(o,t)}}).filter(e=>e.time&&e.score)}),w(n),j(Object.keys(n))},[a]),(0,o.useEffect)(()=>{Object.entries(v).map(e=>{var t,n;let[r,o]=e;if(!o.length){let e=m.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===r+"/"}),t=(null==e?void 0:null===(n=e.ObjectInfo)||void 0===n?void 0:n.CreateAt)||0,o=[],a=p(t,o);return{noteId:r,curve:x(t,o,.25,45,3,.05),stdCurve:x(t,[],.2,45,3,.3),reviewPoints:a,hasReview:!1}}let a=m.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===r+"/"}),l=(null==a?void 0:null===(t=a.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0,i=o.map(e=>({timestamp:e.time,score:e.score})),c=p(l,i),s=y(c);return{noteId:r,curve:x(l,i,s,45,3,.2),stdCurve:x(l,[],.2,45,3,.3),reviewPoints:c,hasReview:!0}})},[v,m]),Date.now();let A=S.map(e=>{var t;let n=m.find(t=>{var n;return(null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName)===e+"/"}),r=(null==n?void 0:null===(t=n.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0,o=(v[e]||[]).map(e=>({timestamp:e.time,score:e.score})),a=o.length>0,l=p(r,o),i=a?y(l):.25,c=a?x(r,o,i,45,3,.2):x(r,o,.25,45,3,.05),s=x(r,[],.2,45,3,.3);return{noteId:e,curve:c,stdCurve:s,reviewPoints:l,hasReview:a}}),L=.25,k=[],D=0,M=[];S.forEach(e=>{var t;let n=m.find(t=>{var n;return(null===(n=t.ObjectInfo)||void 0===n?void 0:n.ObjectName)===e+"/"}),r=(null==n?void 0:null===(t=n.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0;(!D||r<D)&&(D=r);let o=(v[e]||[]).map(e=>({timestamp:e.time,score:e.score}));if(o.length>0){let t=p(r,o);M.push(y(t)),t.forEach(t=>k.push({t:t.t,r:t.r,noteId:e}))}}),M.length>0&&(L=M.reduce((e,t)=>e+t,0)/M.length);let P=x(D,[],L,45,3,.2),_=x(D,[],.2,45,3,.3),R=[{value:"global",label:n.global},...S.map(e=>({value:e,label:e}))];return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col text-white",children:[(0,r.jsx)(i.Z,{lang:e,setLang:t}),(0,r.jsxs)("div",{className:"max-w-5xl w-full mx-auto mt-2 mb-12 rounded-3xl shadow-2xl border border-cyan-500/30 bg-slate-900/80 pt-6 pb-10 px-10 flex flex-col items-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-2 text-cyan-300 drop-shadow-lg tracking-wide",children:n.title}),(0,r.jsx)("div",{className:"flex justify-center w-full mb-8",children:(0,r.jsx)("div",{className:"w-full max-w-md",children:(0,r.jsx)(d.ZP,{options:R,value:R.find(e=>e.value===N),onChange:e=>C((null==e?void 0:e.value)||"global"),placeholder:n.searchPlaceholder,isSearchable:!0,styles:{container:e=>({...e,minWidth:320,width:"100%",background:"rgba(30,41,59,0.7)",borderRadius:12,boxShadow:"0 0 0 1.5px #22d3ee55",color:"#e0e7ef"}),control:e=>({...e,background:"rgba(30,41,59,0.7)",border:"1.5px solid #22d3ee55",borderRadius:12,color:"#e0e7ef",minHeight:48}),menu:e=>({...e,background:"rgba(30,41,59,0.98)",borderRadius:12,color:"#e0e7ef",zIndex:9999}),option:(e,t)=>({...e,background:t.isSelected?"linear-gradient(90deg,#06b6d4,#6366f1)":t.isFocused?"rgba(14,165,233,0.15)":"transparent",color:t.isSelected?"#fff":"#e0e7ef",borderRadius:8,fontWeight:t.isSelected?700:500}),singleValue:e=>({...e,color:"#e0e7ef"}),input:e=>({...e,color:"#e0e7ef"}),placeholder:e=>({...e,color:"#7dd3fc"})},theme:e=>({...e,borderRadius:12,colors:{...e.colors,primary25:"#0ea5e9",primary:"#06b6d4",neutral0:"rgba(30,41,59,0.7)",neutral80:"#e0e7ef"}})})})}),(0,r.jsx)("div",{className:"w-full max-w-4xl mx-auto",style:{height:480},children:0===S.length?(0,r.jsx)("div",{className:"text-slate-400 text-center pt-32 text-lg tracking-wide",children:n.noData}):(0,r.jsx)("div",{className:"bg-slate-800/80 rounded-2xl shadow-inner border border-cyan-500/20 p-4",style:{height:440,minWidth:600},children:(0,r.jsx)(b,{option:(()=>{let e=[];if("global"===N)e=[{name:n.userCurve,type:"line",data:P.x.map((e,t)=>[1e3*D+864e5*e,Math.round(100*P.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:3,color:"#6366F1"},itemStyle:{color:"#6366F1"}},{name:n.ebbinghausCurve,type:"line",data:_.x.map((e,t)=>[1e3*D+864e5*e,Math.round(100*_.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:2,type:"solid",color:"#22c55e"},itemStyle:{color:"#22c55e"},emphasis:{disabled:!0}},{name:n.reviewPoint,type:"scatter",data:k.map(e=>[1e3*D+864e5*e.t,Math.round(100*e.r),e.noteId]),symbolSize:10,itemStyle:{color:"#f90"},tooltip:{show:!0,trigger:"item",formatter:e=>{let t="";return e.data&&e.data[2]?t=e.data[2]:e.value&&e.value[2]?t=e.value[2]:e.name&&(t=e.name),"".concat(n.reviewPoint,"<br/>").concat("All Notes"!==n.global?"笔记: ".concat(t,"<br/>"):"").concat(n.date,": ").concat(new Date(e.data[0]).toLocaleDateString(),"<br/>").concat(n.retention,": ").concat(e.data[1],"%")}}}];else if("global"!==N){let r=A.find(e=>e.noteId===N);if(r){var t;let o=m.find(e=>{var t;return(null===(t=e.ObjectInfo)||void 0===t?void 0:t.ObjectName)===N+"/"}),a=(null==o?void 0:null===(t=o.ObjectInfo)||void 0===t?void 0:t.CreateAt)||0;e=[{name:r.hasReview?n.userCurve:n.warningCurve,type:"line",data:r.curve.x.map((e,t)=>[1e3*a+864e5*e,Math.round(100*r.curve.y[t])]),smooth:.5,symbol:"none",lineStyle:r.hasReview?{width:3,color:"#6366F1"}:{width:3,color:"#ef4444",type:"solid"},itemStyle:r.hasReview?{color:"#6366F1"}:{color:"#ef4444"}},{name:n.ebbinghausCurve,type:"line",data:r.stdCurve.x.map((e,t)=>[1e3*a+864e5*e,Math.round(100*r.stdCurve.y[t])]),smooth:.5,symbol:"none",lineStyle:{width:2,type:"solid",color:"#22c55e"},itemStyle:{color:"#22c55e"},emphasis:{disabled:!0}},{name:n.reviewPoint,type:"scatter",data:r.curve.reviewPoints.map(e=>[1e3*a+864e5*e.t,Math.round(100*e.r)]),symbolSize:10,itemStyle:{color:"#f90"},tooltip:{show:!0,formatter:e=>"".concat(n.reviewPoint,"<br/>").concat(n.date,": ").concat(new Date(e.data[0]).toLocaleDateString(),"<br/>").concat(n.retention,": ").concat(e.data[1],"%")}}]}}return e.length&&e[0].data&&0!==e[0].data.length?{tooltip:{trigger:"axis",formatter:e=>Array.isArray(e)?e.map(e=>"".concat(e.seriesName,": ").concat(e.data[1],"%<br/>").concat(new Date(e.data[0]).toLocaleDateString())).join("<br/>"):"",backgroundColor:"rgba(30,41,59,0.98)",borderColor:"#22d3ee",textStyle:{color:"#fff",fontWeight:500}},legend:{data:e.map(e=>e.name),textStyle:{color:"#fff",fontWeight:600,fontSize:15}},xAxis:{type:"time",name:n.date,axisLabel:{color:"#fff",fontWeight:500,fontSize:14,formatter:e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"-").concat(t.getDate())}},nameTextStyle:{color:"#fff",fontWeight:600,fontSize:15},axisLine:{lineStyle:{color:"#fff"}},axisTick:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",name:n.yLabel,min:0,max:100,axisLabel:{color:"#fff",fontWeight:500,fontSize:14},nameTextStyle:{color:"#fff",fontWeight:600,fontSize:15},axisLine:{lineStyle:{color:"#fff"}},axisTick:{lineStyle:{color:"#fff"}},splitLine:{lineStyle:{color:"#334155"}}},dataZoom:[{type:"slider",xAxisIndex:0},{type:"inside",xAxisIndex:0}],series:e}:{xAxis:{type:"time",name:n.date},yAxis:{type:"value",min:0,max:100,name:n.yLabel},series:[]}})(),notMerge:!0,lazyUpdate:!0,style:{height:440,background:"transparent"}})})})]})]})}},993:function(){},46601:function(){},89214:function(){},85568:function(){},20131:function(){},16026:function(){},24654:function(){},88924:function(){},55024:function(){}},function(e){e.O(0,[3417,6792,3714,7878,1311,8742,6035,3631,9506,8764,7252,5640,5174,2993,366,9774,2888,179],function(){return e(e.s=94072)}),_N_E=e.O()}]);